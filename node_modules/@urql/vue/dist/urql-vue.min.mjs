import{Client as e,createRequest as u}from"@urql/core";export*from"@urql/core";import{isRef as n,ref as t,provide as a,getCurrentInstance as r,inject as o,reactive as i,watchEffect as v,onBeforeUnmount as l,onMounted as c}from"vue";import{subscribe as s,onEnd as f,toPromise as p,take as h}from"wonka";function b(){return(b=Object.assign||function(e){for(var u=1;u<arguments.length;u++){var n=arguments[u];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e}).apply(this,arguments)}function x(u){var r;return r=n(u)?u:t(u instanceof e?u:new e(u)),a("$urql",r),r.value}function y(u,a){var r;r=n(a)?a:t(a instanceof e?a:new e(a)),u.provide("$urql",r)}function d(){return o("$urql")}function q(e){return e&&n(e)?e.value:e}var m={flush:"pre"};function P(e){return g(e)}function g(e,a,r){void 0===a&&(a=d()),void 0===r&&(r=[]);var o=i(e),l=t(),c=t(!1),p=t(!1),h=t(),x=t(),y=t(),P=n(e.pause)?e.pause:t(!!e.pause),g=t(u(o.query,q(o.variables))),w=t();r.push(v((function(){var e=u(o.query,q(o.variables));g.value.key!==e.key&&(g.value=e)}),m)),r.push(v((function(){w.value=P.value?void 0:a.value.executeQuery(g.value,b({},{requestPolicy:o.requestPolicy},o.context))}),m));var k={data:l,stale:c,error:h,operation:x,extensions:y,fetching:p,isPaused:P,executeQuery:function(e){var u=w.value=a.value.executeQuery(g.value,b({},{requestPolicy:o.requestPolicy},o.context,e));return b({},Q,{then:function(e,n){return new Promise((function(e){var n=!1,t=s((function(){k.fetching.value||k.stale.value||(t&&t.unsubscribe(),n=!0,e(k))}))(u);n&&t.unsubscribe()})).then(e,n)}})},pause:function(){P.value=!0},resume:function(){P.value=!1}};r.push(v((function(e){w.value?(p.value=!0,c.value=!1,e(s((function(e){l.value=e.data,c.value=!!e.stale,p.value=!1,h.value=e.error,x.value=e.operation,y.value=e.extensions}))(f((function(){p.value=!1,c.value=!1}))(w.value)).unsubscribe)):(p.value=!1,c.value=!1)}),{flush:"sync"}));var Q=b({},k,{then:function(e,u){return new Promise((function(e){if(!w.value)return e(k);var u=!1,n=s((function(){k.fetching.value||k.stale.value||(n&&n.unsubscribe(),u=!0,e(k))}))(w.value);u&&n.unsubscribe()})).then(e,u)}});return Q}function w(e){return k(e)}function k(e,n){void 0===n&&(n=d());var a=t(),r=t(!1),o=t(!1),i=t(),v=t(),l=t();return{data:a,stale:r,fetching:o,error:i,operation:v,extensions:l,executeMutation:function(t,c){return o.value=!0,p(h(1)(n.value.executeMutation(u(e,q(t)),c||{}))).then((function(e){return a.value=e.data,r.value=!!e.stale,o.value=!1,i.value=e.error,v.value=e.operation,l.value=e.extensions,e}))}}}var Q={flush:"pre"};function S(e,u){return M(e,u)}function M(e,a,r,o){void 0===r&&(r=d()),void 0===o&&(o=[]);var l=i(e),c=t(),p=t(!1),h=t(!1),x=t(),y=t(),m=t(),P=t(a),g=n(e.pause)?e.pause:t(!!e.pause),w=t(u(l.query,q(l.variables))),k=t();o.push(v((function(){var e=u(l.query,q(l.variables));w.value.key!==e.key&&(w.value=e)}),Q)),o.push(v((function(){k.value=g.value?void 0:r.value.executeSubscription(w.value,b({},l.context))}),Q)),o.push(v((function(e){k.value?(h.value=!0,e(s((function(e){h.value=!0,c.value=void 0!==e.data&&"function"==typeof P.value?P.value(c.value,e.data):e.data,x.value=e.error,m.value=e.extensions,p.value=!!e.stale,y.value=e.operation}))(f((function(){h.value=!1}))(k.value)).unsubscribe)):h.value=!1}),Q));var S={data:c,stale:p,error:x,operation:y,extensions:m,fetching:h,isPaused:g,executeSubscription:function(e){return k.value=r.value.executeSubscription(w.value,b({},l.context,e)),S},pause:function(){g.value=!0},resume:function(){g.value=!1}};return S}function O(){var e=d(),u=[];return l((function(){for(var e;e=u.shift();)e()})),{client:e.value,useQuery:function(n){return g(n,e,u)},useSubscription:function(n,t){return M(n,t,e,u)},useMutation:function(u){return k(u,e)}}}export default y;export{y as install,x as provideClient,O as useClientHandle,w as useMutation,P as useQuery,S as useSubscription};
//# sourceMappingURL=urql-vue.min.mjs.map
